<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
  <title>Random MST3K-O-Matic</title>
  <script>if (typeof module === 'object') { window.module = module; module = undefined; }</script>
  <script type="text/javascript" src="./scripts/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="./scripts/skeletabs.js"></script>
  <script type="text/javascript" src="./scripts/jquery.magnific-popup.js"></script>
  <script type="text/javascript" src="./scripts/jquery.imgcheckbox.js"></script>
  <script type="text/javascript" src="./scripts/dd.min.js"></script>
  <script type="text/javascript" src="./quotes.js"></script>
  <script type="text/javascript" src="./summaries.js"></script>
  <script src="./scripts/popper.min.js"></script>
  <script src="./scripts/tippy-bundle.umd.js"></script>
  <link href="./scripts/matic.css" rel="stylesheet" type="text/css">
  <link href='./scripts/skeletabs.css' rel='stylesheet' type='text/css'>
  <link href='./scripts/magnific-popup.css' rel='stylesheet' type='text/css'>
  <link href='./scripts/dd.css' rel='stylesheet' type='text/css'>
  <script>
    const { ipcRenderer } = require('electron');
    require('./renderer.js')
  </script>
</head>

<body>
  <h2 id="quote"style="text-align:center;">&nbsp;</h2>
  <div id="tabContainer" class="skltbs-theme-light">
    <ul class="skltbs-tab-group">
      <li class="skltbs-tab-item">
        <button class="skltbs-tab">The Satellite Crew</button>
      </li>
      <li class="skltbs-tab-item">
        <button class="skltbs-tab">The Mads</button>
      </li>
      <li class="skltbs-tab-item">
        <button class="skltbs-tab">The Options</button>
      </li>
    </ul>
    <div class="skltbs-panel-group">
      <div class="skltbs-panel">
        <table style="width:100%;">
          <tr><td style="color:white; text-align:center;">Choose A Host:<br/>
            <select id="theHost" is="ms-dropdown">
              <option value="IS NOT NULL" data-image="images/johnny.jpg" data-description="Why doesn't Johnny care?">I don't care!</option>
              <option value="LIKE '%jh%'" data-image="images/joel.jpg" data-description="&quot;Joel Robinson&quot;<br/>Seasons K-5">Joel Hodgson</option>
              <option value="LIKE '%mn%'" data-image="images/mike.jpg" data-description="&quot;Mike Nelson&quot;<br/>Seasons 5-10">Mike Nelson</option>
              <option value="LIKE '%jr%'" data-image="images/jonah.jpg" data-description="&quot;Jonah Heston&quot;<br/>Seasons 11-Present">Jonah Ray</option>
              <option value="LIKE '%em%'" data-image="images/emily.jpg" data-description="&quot;Emily Connor&quot;<br/>Season 13-Present">Emily Marsh</option>
            </select>
          </td>
          <td style="color:white; text-align:center;">Choose A Crow:<br/>
            <select id="theCrow" is="ms-dropdown">
              <option value="IS NOT NULL" data-image="images/johnny.jpg" data-description="Why doesn't Johnny care?">I don't care!</option>
              <option value="LIKE '%jw%'" data-image="images/josh.jpg" data-description="Season K">Josh Weinstein</option>
              <option value="LIKE '%tb%'" data-image="images/trace.jpg" data-description="Seasons K-7">Trace Beaulieu</option>
              <option value="LIKE '%bc%'" data-image="images/bill.jpg" data-description="Seasons 8-10">Bill Corbett</option>
              <option value="LIKE '%hy%'" data-image="images/hampton.jpg" data-description="Seasons 11-Present">Hampton Yount</option>
              <option value="LIKE '%kab%'" data-image="images/kelsey.jpg" data-description="Seasons 13-Present">Kelsey Ann Brady</option>
            </select>
          </td><td style="color:white; text-align:center;">Choose A Tom Servo:<br/>
            <select id="theTom" is="ms-dropdown">
              <option value="IS NOT NULL" data-image="images/johnny.jpg" data-description="Why doesn't Johnny care?">I don't care!</option>
              <option value="LIKE '%jw%'" data-image="images/josh.jpg" data-description="Seasons K-1,13">Josh Weinstein</option>
              <option value="LIKE '%km%" data-image="images/kevin.jpg" data-description="Seasons 2-10">Kevin Murphy</option>
              <option value="LIKE '%bv%'" data-image="images/baron.jpg" data-description="Seasons 11-Present">Baron Vaughn</option>
              <option value="LIKE '%cm%'" data-image="images/conor.jpg" data-description="Seasons 13-Present">Conor McGiffin</option>
            </select>
          </td></tr>
          </table>
      </div>
      <div class="skltbs-panel">
          <table style="width:100%">
            <tr>
              <td style="text-align:center;color:white;"><img class="madsImage" name="drf" src="images/drf.jpg"><br/>Dr. Clayton Forrester<br/><span style="font-size:.8em;">Trace Beaulieu<br/>Seasons K-7</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="larry" src="images/larry.jpg"><br/>Dr. Larry Erhardt<br/><span style="font-size:.8em;">Josh Weinstein<br/>Seasons K-1</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="frank" src="images/frank.jpg"><br/>TV's Frank<br/><span style="font-size:.8em;">Frank Conniff<br/>Seasons 2-6, 10</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="pearl" src="images/pearl.jpg"><br/>Pearl Forrester<br/><span style="font-size:.8em;">Mary Jo Pehl<br/>Seasons 6-11, 13</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="bobo" src="images/bobo.jpg"><br/>Professor Bobo<br/><span style="font-size:.8em;">Kevin Murphy<br/>Seasons 8-11</span></td>
            </tr>
            <tr>
              <td style="text-align:center;color:white;"><img class="madsImage" name="observer" src="images/observer.jpg"><br/>Observer<br/><span style="font-size:.8em;">Bill Corbett<br/>Seasons 8-11</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="kinga" src="images/kinga.jpg"><br/>Kinga Forrester<br/><span style="font-size:.8em;">Felicia Day<br/>Season 11-Present</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="max" src="images/max.jpg"><br/>Max<br/><span style="font-size:.8em;">Patton Oswalt<br/>Seasons 11-Present</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="synthia" src="images/synthia.jpg"><br/>Synthia<br/><span style="font-size:.8em;">Rebecca Hanson<br/>Seasons 11-Present</span></td>
              <td style="text-align:center;color:white;"><img class="madsImage" name="megasynthia" src="images/megasynthia.jpg"><br/>Mega-Synthia<br/><span style="font-size:.8em;">Yvonne Freese<br/>Seasons 13-Present</span></td>
            </tr>
          </table>
      </div>
      <div class="skltbs-panel">
        <table style="width:100%;">
          <tr><td style="color:white; text-align:center;">Choose A Decade:<br/>
                <select id="theDecade" is="ms-dropdown" data-visible-rows="6">
                  <option value="IS NOT NULL" data-image="images/johnny.jpg" data-description="Why doesn't Johnny care?">I don't care!</option>
                  <option value="between 1940 and 1949" data-image="images/1940s.jpg" data-description="&nbsp;">1940's</option>
                  <option value="between 1950 and 1959" data-image="images/1950s.jpg" data-description="&nbsp;">1950's</option>
                  <option value="between 1960 and 1969" data-image="images/1960s.jpg" data-description="&nbsp;">1960's</option>
                  <option value="between 1970 and 1979" data-image="images/1970s.jpg" data-description="&nbsp;">1970's</option>
                  <option value="between 1980 and 1989" data-image="images/1980s.jpg" data-description="&nbsp;">1980's</option>
                  <option value="between 1990 and 1999" data-image="images/1990s.jpg" data-description="&nbsp;">1990's</option>
                  <!--<option value="between 2000 and 2009" data-image="images/jonah.jpg" data-description="&nbsp;">2000's</option>-->
                  <option value="between 2010 and 2019" data-image="images/2010s.jpg" data-description="&nbsp;">2010's</option>
                </select>
              </td>
              <td style="color:white; text-align:center;">Country of Origin:<br/>
                <select id="theCountry" is="ms-dropdown" data-visible-rows="6">
                  <option value="IS NOT NULL" data-image="images/johnny.jpg" data-description="Why doesn't Johnny care?">I don't care!</option>
                  <option value="like '%Argentina%'" data-image="images/ar.svg" data-description="&nbsp;">Argentina</option>
                  <option value="like '%Brazil%'" data-image="images/br.svg" data-description="&nbsp;">Brazil</option>
                  <option value="like '%Canada%'" data-image="images/ca.svg" data-description="&nbsp;">Canada</option>
                  <option value="like '%Denmark%'" data-image="images/dk.svg" data-description="&nbsp;">Denmark</option>
                  <option value="like '%East Germany%'" data-image="images/eg.svg" data-description="&nbsp;">East Germany</option>
                  <option value="like '%Finland%'" data-image="images/fi.svg" data-description="&nbsp;">Finland</option>
                  <option value="like '%France%'" data-image="images/fr.svg" data-description="&nbsp;">France</option>
                  <option value="like '%Italy%'" data-image="images/it.svg" data-description="&nbsp;">Italy</option>
                  <option value="like '%Japan%'" data-image="images/jp.svg" data-description="&nbsp;">Japan</option>
                  <option value="like '%Liechtenstein%'" data-image="images/li.svg" data-description="&nbsp;">Liechtenstein</option>
                  <option value="like '%Mexico%'" data-image="images/mx.svg" data-description="&nbsp;">Mexico</option>
                  <option value="like '%Philippines%'" data-image="images/ph.svg" data-description="&nbsp;">Philippines</option>
                  <option value="like '%Poland%'" data-image="images/pl.svg" data-description="&nbsp;">Poland</option>
                  <option value="like '%USSR%'" data-image="images/ussr.svg" data-description="&nbsp;">Russia</option>
                  <option value="South Africa%'" data-image="images/za.svg" data-description="&nbsp;">South Africa</option>
                  <option value="South Korea%'" data-image="images/kr.svg" data-description="&nbsp;">South Korea</option>
                  <option value="like '%Spain%'" data-image="images/es.svg" data-description="&nbsp;">Spain</option>
                  <option value="like '%UK%'" data-image="images/gb.svg" data-description="&nbsp;">United Kingdom</option>
                  <option value="like '%USA%'" data-image="images/us.svg" data-description="&nbsp;">United States</option>
                  <option value="like '%West Germany%'" data-image="images/wg.svg" data-description="&nbsp;">West Germany</option>
                </select>
              </td>
              <td></td>
            </tr>
            <tr>
              <td style="text-align:center;color:white;"><img class="optionsImage" name="short" src="images/short.jpg"><br/>Only show episodes with shorts</td>
              <td style="text-align:center;color:white;"><img class="optionsImage" name="streaming" src="images/streaming.png"><br/>Only show episodes available for streaming</td>
              <td style="padding-top:20px; text-align:center;color:white;"><img class="optionsImage" name="bw" src="images/bw.png"><br/>Only show black and white movies</td>
            </tr>
        </table>
      </div>
    </div>
  </div>
  <div class="footer">
    <input type="button" class="fakeSkeletab" id="movieSign" value="Push the button, Frank.">
  </div>
  <div id="movieSignPopup" class="white-popup mfp-hide">
    <h1 style="width:100%; text-align:center;">WE'VE GOT MOVIE SIGN!!!!</h1>
    <h1 style="width:100%; text-align:center;" id="result"></h1>
    <div style="width: 100%; height: 500px; text-align: center; display: flex;">
  <div style="width: 65%; text-align: center; display: flex; align-items: center; justify-content: center;">
    <img id="moviePoster" src="" style="max-height: 500px; max-width: 667px;">
    </div>
    <div id="summaryContainer" style="width: 35%; height: 500px; display: table;">
      <div id="summary" style="display: table-cell; vertical-align: middle; padding: 10px; text-align: left;">
      </div>
    </div>
  </div>

    <div class="footer" style="bottom: 50px!important; text-align:center; width:100%; padding-top:20px;">
        <div class="streamTD" id="mst3kTD"><a id="mst3kURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Stream or Buy this episode at The Gizmoplex"><img src="images/mst3k.png" style="width:50px;"></a></div>
        <div class="streamTD" id="rifftraxTD"><a id="rifftraxURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Buy this episode from RiffTrax"><img src="images/rifftrax.png" style="width:50px;"></a></div>
        <div class="streamTD" id="netflixTD"><a id="netflixURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Stream this epsiode on Netflix"><img src="images/netflix.png" style="width:50px;"></a></div>
        <div class="streamTD" id="youtubeTD"><a id="youtubeURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Stream this epsiode on YouTube"><img src="images/youtube.png" style="width:50px;"></a></div>
        <div class="streamTD" id="shoutTD"><a id="shoutURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Stream this epsiode at Shout Factory"><img src="images/shout.png" style="width:50px;"></a></div>
        <div class="streamTD" id="tubiTD"><a id="tubiURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Stream this epsiode on Tubi"><img src="images/tubi.png" style="width:50px;"></a></div>
        <div class="streamTD" id="amazonTD"><a id="amazonURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Buy or rent this episode from Amazon"><img src="images/amazon.png" style="width:50px;"></a></div>
        <div class="streamTD" id="itunesTD"><a id="itunesURL" href="" target="_blank" class="zebra_tips1" data-tippy-content="Buy or rent this epsiode on iTunes"><img src="images/itunes.png" style="width:50px;"></a></div>
        <div class="streamTD"><a id="refresh" href="" class="zebra_tips1" data-tippy-content="Search for a different episode with the same criteria"><img src="images/reload.png" style="width:50px;"></a></div>
    </div>
  </div>
  <div id="noMovie" class="white-popup mfp-hide">
    <div style="width: 100%; text-align:center;">
      <img src="images/poopie.jpg">
    </div>
    <h2 style="width:100%; text-align:center;">Sorry, no movies were found that match your criteria.  Try again!</h2>
  </div>
  <div id="aboutDiv" class="white-popup mfp-hide">
    <div style="width:100%; text-align:center;">	
			<span class="header" style="font-size:2em!important;">About The Random MST3K-O-Matic</span><div id="currentVersion"></div>
		</div>
    <div style="width: 100%; text-align:center; margin-top:50px;">
      This app was created because my wife and I frequently sit down to watch an episode of Mystery Science Theater 3000, but can't decide which episode we want to watch.<br/><br/>
      So I decided to let a random number generator determine our entertainment fate (not to be confused with the Hands of Fate).<br/><br/>
      I am not affiliated with the creators and/or rights holders of Mystery Science Theater 3000, Netflix, Rifftrax, Shout Factory, Best Brains, Alternaversal, any of the movies or anybody or anything else who has any official capacity with the show that I may be forgetting or unaware of.<br/><br/>
      Basically, this is really just a fancy dartboard.
    </div>
  </div>
  <div id="pleaseWait" class="white-popup mfp-hide">
    <h1 style="text-align:center; color:black;">Communicating With Deep 13, Please Wait...</h1>
    <div style="position:absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
      <img src="images/mst3k.png" class="rotate" style="height:350px;">
    </div>
    <!--<div style="position:relative; width: 100%; height: 100%; text-align:center; border:1px solid blue;">
      HI THERE
    </div>-->
  </div>
  <input type="button" id="about" style="display:none;">
  <input type="button" id="checkForUpdates" style="display:none;">
</body>
<script>

tippy.setDefaultProps({theme: 'mst', arrow: false});

getQuote()

$(document).ready(function() {
  $("img.madsImage").imgCheckbox();
  $("img.optionsImage").imgCheckbox();
  tippy('[data-tippy-content]');
/*   $.magnificPopup.open({
      items: {
        src: '#pleaseWait'
      },
      type: 'inline',
      modal: true
    }); */
})

$("#about").on("click", function() {
  $.magnificPopup.open({
      items: {
        src: '#aboutDiv'
      },
      type: 'inline'
    });
})

$("#checkForUpdates").on("click", function() {
  ipcRenderer.send('check-for-update', {type:"manual"})
})

$('#tabContainer')
  .on('skeletabs:move', function(event, info) {
    getQuote()
  })
  .skeletabs();

$("#refresh").on("click",function(e) {
  e.preventDefault()
  $("#movieSign").click()
})

$("#movieSign").on("click",function(e){
  $("#result").html("")
  let data = {}
  let mads = []
  let options = []
  
  $(".madsImage").each(function(){
    if ($(this).parent().hasClass("imgChked")) {
      let obj = {}
      obj[$(this).attr("name")] = 1
      mads.push(obj)
    }
  })

  $(".optionsImage").each(function(){
    if ($(this).parent().hasClass("imgChked")) {
      let obj = {}
      obj[$(this).attr("name")] = 1
      options.push(obj)
    }
  })

  data.host = $("#theHost").val()
  data.crow = $("#theCrow").val()
  data.tom = $("#theTom").val()
  data.decade = $("#theDecade").val()
  data.country = $("#theCountry").val()
  data.mads = mads
  data.options = options
  console.log(data)
  //ipcRenderer.send('movie-request', data)
})

ipcRenderer.on('movie-sign', (event, data) => { 
  console.log(data)
  if (data.rows == 0) { 
    $.magnificPopup.open({
      items: {
        src: '#noMovie'
      },
      type: 'inline'
    });
  } else {
    let streams = 0
    if (data.movie.amazon != null) {
      $("#amazonTD").css("display","inline-block")
      $("#amazonURL").attr("href", data.movie.amazon)
      streams++
    } else {
      $("#amazonTD").css("display","none")
      $("#amazonURL").attr("href", "")
    }
    if (data.movie.itunes != null) {
      $("#itunesTD").css("display","inline-block")
      $("#itunesURL").attr("href",data.movie.itunes)
      streams++
    } else {
      $("#itunesTD").css("display","none")
      $("#itunesURL").attr("href","")
    }
    if (data.movie.mst3k != null) {
      $("#mst3kTD").css("display","inline-block")
      $("#mst3kURL").attr("href",data.movie.mst3k)
      streams++
    } else {
      $("#mst3kTD").css("display","none")
      $("#mst3kURL").attr("href","")
    }
    if (data.movie.netflix != null) {
      $("#netflixTD").css("display","inline-block")
      $("#netflixURL").attr("href","https://www.netflix.com/watch/"+data.movie.netflix)
      streams++
    } else {
      $("#netflixTD").css("display","none")
      $("#netflixURL").attr("href","")
    }
    if (data.movie.rifftrax != null) {
      $("#rifftraxTD").css("display","inline-block")
      $("#rifftraxURL").attr("href",data.movie.rifftrax)
      streams++
    } else {
      $("#rifftraxTD").css("display","none")
      $("#rifftraxURL").attr("href","")
    }
    if (data.movie.shout != null) {
      $("#shoutTD").css("display","inline-block")
      $("#shoutURL").attr("href",data.movie.shout)
      streams++
    } else {
      $("#shoutTD").css("display","none")
      $("#shoutURL").attr("href","")
    }
    if (data.movie.youtube != null) {
      $("#youtubeTD").css("display","inline-block")
      $("#youtubeURL").attr("href","https://www.youtube.com/watch?v="+data.movie.youtube)
      streams++
    } else {
      $("#youtubeTD").css("display","none")
      $("#youtubeURL").attr("href","")
    }
    if (data.movie.tubi != null) {
      $("#tubiTD").css("display","inline-block")
      $("#tubiURL").attr("href",data.movie.tubi)
      streams++
    } else {
      $("#tubiTD").css("display","none")
      $("#tubiURL").attr("href","")
    }
    $(".streamTD").css("width",100/(streams+1)+"%")
    $("#result").html("Experiment "+data.movie.experiment+": &quot;"+data.movie.movie+"&quot;")
    $("#moviePoster").attr("src","epthumbs/"+data.movie.experiment+".jpg")
    $("#streamingServices").html(JSON.stringify(streams))
    $("#summary").css({
      'background-image': "linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),url('./posters/" + data.movie.experiment + ".jpg')",
      'background-position': 'center',
      'background-repeat': 'no-repeat'
  });
    $("#summary").html(summaries[data.movie.experiment])
    $.magnificPopup.open({
      items: {
        src: '#movieSignPopup'
      },
      type: 'inline'
    });
  }
})

ipcRenderer.on('hide-spinner', (event, data) => {
  $.magnificPopup.close();
})

function getQuote() {
  $("#quote").html(quotes[(Math.floor(Math.random() * quotes.length))])
}
</script>

</html>